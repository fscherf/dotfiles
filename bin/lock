#!/bin/bash

set -x
set -e

HOST=$1

if [ "$HOST" == "" ]; then
    HOST=$HOSTNAME
fi

# ripley ######################################################################
if [ "$HOST" == "ripley" ]; then

    # wd-white-8tb (data)
    name="wd-white-8tb"

    sudo umount "/home/fscherf/data/$name"
    sudo cryptsetup luksClose "$name"

    # seagate-red-8tb (backup)
    name="seagate-red-8tb"

    sudo umount "/srv/storage/$name"
    sudo cryptsetup luksClose "$name"

    exit 0
fi

# clerk #######################################################################
if [ "$HOST" == "clerk" ]; then

    # kingston-128gb-1 (data)
    name="kingston-128gb-1"

    sudo umount "/home/fscherf/data/$name"
    sudo cryptsetup luksClose "$name"

    # kingston-128gb-2 (data)
    name="kingston-128gb-2"

    sudo umount "/home/fscherf/data/$name"
    sudo cryptsetup luksClose "$name"

    exit 0
fi

# catch all
exit 1
