#!/bin/bash

set -x
set -e

HOST=$1

if [ "$HOST" == "" ]; then
    HOST=$HOSTNAME
fi

# ripley ######################################################################
if [ "$HOST" == "ripley" ]; then

    # wd-white-8tb (data)
    sudo cryptsetup luksOpen /dev/disk/by-uuid/ff81e24a-4bcc-446d-8c9c-a197613fe93d wd-white-8tb

    if [ ! -d /home/fscherf/data/wd-white-8tb ]; then
        mkdir -p /home/fscherf/data/wd-white-8tb
    fi

    sudo mount /dev/mapper/wd-white-8tb /home/fscherf/data/wd-white-8tb

    # seagate-red-8tb (backup)
    sudo cryptsetup luksOpen /dev/disk/by-uuid/fa19c561-7d93-4dfc-9314-a332679d0ef3 seagate-red-8tb

    if [ ! -d /srv/storage/seagate-red-8tb ]; then
        mkdir -p /srv/storage/seagate-red-8tb
    fi

    sudo mount /dev/mapper/seagate-red-8tb /srv/storage/seagate-red-8tb

    exit 0
fi

# clerk #######################################################################
if [ "$HOST" == "clerk" ]; then

    # kingston-128gb-1 (data)
    name="kingston-128gb-1"
    path="/home/fscherf/data/$name"
    uuid="359ab777-6a89-4f43-9649-b637870dc3c4"
    device="/dev/disk/by-uuid/$uuid"
    mapper_device="/dev/mapper/$name"

    if [ -e "$device" ]; then
        sudo cryptsetup luksOpen "$device" "$name"

        if [ ! -d "$path" ]; then
            mkdir -p "$path"
        fi

        sudo mount "$mapper_device" "$path"
    fi

    # kingston-128gb-2 (backup)
    name="kingston-128gb-2"
    path="/srv/storage/$name"
    uuid="a64217e9-63fa-44f9-94b8-697be185add6"
    device="/dev/disk/by-uuid/$uuid"
    mapper_device="/dev/mapper/$name"

    if [ -e "$device" ]; then
        sudo cryptsetup luksOpen "$device" "$name"

        if [ ! -d "$path" ]; then
            sudo mkdir -p "$path"
            sudo chown fscherf:fscherf $path
        fi

        sudo mount "$mapper_device" "$path"
    fi

    exit 0
fi

# catch all
exit 1
